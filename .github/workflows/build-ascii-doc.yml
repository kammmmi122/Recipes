name: Build asciidoc

on:
  push:
    branches:
      - main
  pull_request:

jobs:
  megalinter:
    name: Ascii Doc
    runs-on: self-hosted

    steps:
      # Git Checkout
      - name: Checkout Code
        uses: actions/checkout@v3
        with:
          token: ${{ secrets.PAT || secrets.GITHUB_TOKEN }}
          fetch-depth: 0
          lfs: 'true'
      - name: Install asciidoctor
        run: |
          sudo apt-get install -y asciidoctor

      - name: Build
        run: |
          asciidoctor --backend=html5 *.adoc
          asciidoctor -D Przetwory --backend=html5 Przetwory/*.adoc
      - name: Publish
        uses: actions/upload-artifact@v3
        with:
          name: out
          path: |
           *.html
           *.jpg
           Przetwory/*.jpg
           Przetwory/*.html

      - name: Cleanup build folder
        run: |
            ls -la ./
            rm -rf ./* || true
            rm -rf ./.??* || true
            ls -la ./
